<!doctype html>
<html lang="ru">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
  <title>SmartGuma ‚Äî –¶–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–∞—Ä–∫—É, –¢–° –∏ —à–∏–Ω–∞–º</title>
  <style>
    :root{--bg:#0b1020;--card:rgba(255,255,255,.06);--text:rgba(255,255,255,.98);--muted:rgba(255,255,255,.88);--border:rgba(255,255,255,.18);--ok:#34d399;--warn:#fbbf24;--crit:#fb7185;--accent1:rgba(59,130,246,.85);--accent2:rgba(168,85,247,.80);--shadow:0 18px 50px rgba(0,0,0,.45);--radius:18px}
    *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
    html{height:100%}
    body{margin:0;min-height:100%;font-family:ui-sans-serif,system-ui,-apple-system,Segoe UI,Roboto,Inter,Arial,"Noto Sans","Helvetica Neue",sans-serif;color:var(--text);background:radial-gradient(1200px 600px at 20% -10%,rgba(59,130,246,.35),transparent 60%),radial-gradient(900px 500px at 90% 10%,rgba(168,85,247,.25),transparent 55%),radial-gradient(700px 500px at 40% 110%,rgba(16,185,129,.20),transparent 55%),var(--bg);background-attachment:fixed;padding:12px;padding-top:calc(12px + env(safe-area-inset-top));padding-bottom:calc(12px + env(safe-area-inset-bottom));overflow-x:hidden}
    .wrap{max-width:1180px;margin:0 auto}
    @media(max-width:979px){
      body{padding:14px;padding-top:calc(14px + env(safe-area-inset-top));padding-bottom:calc(68px + env(safe-area-inset-bottom))}
      .topbar{padding:10px 12px}
      .brand p{font-size:11px}
      .productIntro{padding:10px 12px;margin-top:8px;font-size:11px;line-height:1.45}
      .productIntro .row{margin-top:6px}
      .productIntro .row:first-child{margin-top:0}
      .grid{gap:14px;margin-top:14px}
      .cardHeader{padding:12px 0}
      .cardBody{padding:12px 0}
      .headerTop .tabs{display:flex;overflow-x:auto;width:100%}
      .tab{min-height:44px;padding:12px 14px;font-size:13px}
      .kpiRow{gap:10px;margin-top:12px}
      .kpi{min-height:82px;padding:12px}
      .filterChips{gap:10px;margin-top:12px}
      .chip{padding:8px 12px;min-height:44px}
      .sectionTitle{margin-bottom:6px}
      .prioritySection{margin-top:16px}
      .list{gap:12px;margin-top:12px}
      .item{padding:14px}
      .btn{min-height:44px;padding:10px 14px}
      .btn.icon{min-width:44px;min-height:44px}
      .pill{min-height:44px;padding:10px 12px}
    }
    @media(max-width:380px){
      .kpiRow{grid-template-columns:1fr}
    }

    .card-base{background:linear-gradient(180deg,rgba(255,255,255,.08),rgba(255,255,255,.05));border:1px solid var(--border);border-radius:var(--radius);box-shadow:var(--shadow)}
    .topbar.card-base{background:linear-gradient(180deg,rgba(18,25,45,.97),rgba(12,18,35,.98));border-color:var(--border);color:var(--text)}
    .topbar .brand h1,.topbar .brand p,.topbar .pill label,.topbar .btn{color:var(--text)}
    .topbar{display:flex;flex-direction:column;gap:12px;padding:12px;position:sticky;top:calc(10px + env(safe-area-inset-top));backdrop-filter:blur(10px);z-index:10}
    .topRow{display:flex;align-items:flex-start;justify-content:space-between;gap:10px}
    .brand{display:flex;gap:10px;align-items:center;min-width:0;flex:1}
    .logo{width:34px;height:34px;border-radius:12px;background:linear-gradient(135deg,var(--accent1),var(--accent2));box-shadow:0 10px 30px rgba(59,130,246,.25);border:1px solid rgba(255,255,255,.14);flex:0 0 auto}
    .brandText{min-width:0}
    .brand h1{margin:0;font-size:14px;line-height:1.15;letter-spacing:.2px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .brand p{margin:4px 0 0;font-size:13px;color:var(--muted);line-height:1.3;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}
    .productIntro{margin-top:10px;padding:10px 12px;border-radius:14px;background:rgba(15,22,42,.85);border:1px solid var(--border);font-size:12px;color:var(--muted);line-height:1.45;max-height:180px;overflow:hidden;transition:max-height .3s ease,opacity .25s ease,margin .25s ease,padding .25s ease,border-width .2s ease}
    .productIntro strong{color:var(--text);font-weight:600}
    .productIntro .row{margin-top:6px}
    .productIntro .row:first-child{margin-top:0}
    body.scrolled .productIntro{max-height:0;opacity:0;margin-top:0;padding-top:0;padding-bottom:0;border-width:0;min-height:0}
    .topActions{display:flex;gap:8px;flex:0 0 auto}

    .btn{padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.06);color:var(--text);font-size:12px;cursor:pointer;transition:transform .08s,background .15s;user-select:none;min-height:42px}
    .btn:hover{background:rgba(255,255,255,.09)}
    .btn:active{transform:translateY(1px)}
    .btn.primary{background:linear-gradient(135deg,var(--accent1),var(--accent2));border-color:rgba(255,255,255,.18)}
    .btn.icon{width:42px;display:flex;align-items:center;justify-content:center;padding:0;font-size:16px}

    .controls{display:flex;flex-direction:column;gap:10px}
    .controlsActions{display:flex;gap:10px;flex-wrap:wrap;align-items:center}
    .controlsCollapsed{display:none}
    .pill{display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:16px;background:rgba(255,255,255,.05);border:1px solid var(--border);min-height:46px}
    .pill label{font-size:12px;color:var(--muted);flex:0 0 auto;min-width:56px}
    select,input[type="search"]{background:transparent;border:none;outline:none;color:var(--text);font-size:14px;width:100%;min-width:0}
    select option{background:#0e1430;color:var(--text)}
    input[type="search"]::placeholder{color:rgba(255,255,255,.6)}

    .grid{display:grid;grid-template-columns:1fr;gap:12px;margin-top:12px}
    .card{overflow:hidden}
    .cardHeader{padding:12px;display:flex;flex-direction:column;gap:10px;border-bottom:1px solid rgba(255,255,255,.08)}
    .headerTop{display:flex;align-items:flex-start;justify-content:space-between;gap:10px;flex-wrap:wrap}
    .headerTop > div:first-child{min-width:0}
    .headerTop .tabs{flex-shrink:0}
    .cardHeader h2{margin:0;font-size:15px;letter-spacing:.2px;font-weight:600}
    .sub{margin:4px 0 0;font-size:13px;color:var(--muted);line-height:1.35}
    .cardBody{padding:12px}

    .tabs{display:flex;gap:8px;overflow-x:auto;-webkit-overflow-scrolling:touch;padding-bottom:2px}
    .tabs::-webkit-scrollbar{height:0}
    .tab{padding:10px 12px;border-radius:14px;border:1px solid var(--border);background:rgba(255,255,255,.05);font-size:12px;cursor:pointer;white-space:nowrap;min-height:42px;display:flex;align-items:center}
    .tab.active{background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.18)}

    .kpiRow{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:10px}
    .kpi{padding:12px;border-radius:16px;background:rgba(255,255,255,.05);border:1px solid rgba(255,255,255,.10);min-height:86px}
    .kpi.clickable{cursor:pointer;transition:background .15s,transform .08s,border-color .15s}
    .kpi.clickable:hover{background:rgba(255,255,255,.08);border-color:rgba(255,255,255,.18)}
    .kpi.clickable:active{transform:scale(.98)}
    .kpi .label{font-size:13px;color:var(--muted);margin-bottom:6px;line-height:1.3}
    .kpi .value{font-size:17px;letter-spacing:.2px;font-weight:600}
    .kpi .hint{margin-top:8px;font-size:13px;color:var(--muted);line-height:1.35}
    .kpi.clickable .hint{color:var(--accent1);cursor:pointer}

    .chip{display:inline-flex;align-items:center;gap:8px;padding:8px 10px;border-radius:999px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);font-size:12px;white-space:nowrap}
    .chip.clickable{cursor:pointer;transition:background .15s,transform .08s,border-color .15s}
    .chip.clickable:hover{background:rgba(255,255,255,.10);border-color:rgba(255,255,255,.22)}
    .chip.clickable:active{transform:scale(.97)}
    .chip.clickable.active{border-color:rgba(59,130,246,.5);background:rgba(59,130,246,.12)}
    .filterChips{display:flex;gap:12px;flex-wrap:wrap;margin-top:14px}
    .dot{width:10px;height:10px;border-radius:999px;background:var(--muted);box-shadow:0 0 0 3px rgba(255,255,255,.06)}
    .dot.ok{background:var(--ok);box-shadow:0 0 0 3px rgba(52,211,153,.15)}
    .dot.warn{background:var(--warn);box-shadow:0 0 0 3px rgba(251,191,36,.14)}
    .dot.crit{background:var(--crit);box-shadow:0 0 0 3px rgba(251,113,133,.14)}
    .badge{padding:6px 8px;border-radius:999px;font-size:11px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06)}
    .badge.ok{border-color:rgba(52,211,153,.25);background:rgba(52,211,153,.08)}
    .badge.warn{border-color:rgba(251,191,36,.25);background:rgba(251,191,36,.08)}
    .badge.crit{border-color:rgba(251,113,133,.25);background:rgba(251,113,133,.08)}
    .badge.best{border-color:rgba(59,130,246,.30);background:rgba(59,130,246,.10);color:rgba(147,197,253,1)}

    .list{display:flex;flex-direction:column;gap:12px;margin-top:12px}
    .item{padding:14px;border-radius:16px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05);display:flex;gap:12px;align-items:flex-start;cursor:pointer;transition:background .15s,transform .08s}
    .item:hover{background:rgba(255,255,255,.08)}
    .item:active{transform:translateY(1px)}
    .item .meta{flex:1;min-width:0}
    .item .title{font-size:13px;margin:0;letter-spacing:.2px;display:flex;align-items:center;gap:8px;flex-wrap:wrap;line-height:1.25}
    .item .desc{margin:6px 0 0;font-size:13px;color:var(--muted);line-height:1.4}

    .vehicleWrap{display:grid;gap:12px}
    .vehicleCard{padding:12px;border-radius:16px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05);overflow:hidden}
    .vehTop{display:flex;justify-content:space-between;gap:10px;align-items:flex-start;flex-wrap:wrap}
    .vehTop h3{margin:0;font-size:13px;letter-spacing:.2px}
    .vehTop .small{margin-top:4px;font-size:13px;color:var(--muted);line-height:1.35}

    /* Driver rating */
    .ratingRow{display:flex;gap:8px;flex-wrap:wrap;align-items:center;margin-top:10px}
    .stars{display:flex;gap:3px;flex-shrink:0}
    .star{width:18px;height:18px;border-radius:6px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;font-size:10px;user-select:none}
    .star.on{background:rgba(251,191,36,.12);border-color:rgba(251,191,36,.25);color:#fbbf24}
    .ratingHint{font-size:12px;color:var(--muted);line-height:1.3}

    /* Vehicle photos */
    .vehPhotos{margin-top:10px;display:flex;gap:8px;flex-wrap:wrap}
    .vehPhoto{width:80px;height:54px;border-radius:12px;border:1px solid rgba(255,255,255,.14);overflow:hidden;background:rgba(255,255,255,.06);cursor:pointer;position:relative}
    .vehPhoto img{width:100%;height:100%;object-fit:cover;display:block}
    .vehPhoto::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.22));pointer-events:none}

    .axles{margin-top:12px;display:grid;gap:10px}
    .axle{display:grid;grid-template-columns:76px 1fr;gap:10px;align-items:start}
    .axle .label{font-size:13px;color:var(--muted);padding-top:10px;line-height:1.3}
    .tires{display:flex;gap:8px;flex-wrap:wrap;padding:10px;border-radius:14px;border:1px dashed rgba(255,255,255,.14);background:rgba(255,255,255,.03)}
    .tire{width:44px;height:44px;border-radius:14px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);display:flex;align-items:center;justify-content:center;font-size:11px;cursor:pointer;user-select:none}
    .tire.ok{box-shadow:inset 0 0 0 2px rgba(52,211,153,.35)}
    .tire.warn{box-shadow:inset 0 0 0 2px rgba(251,191,36,.35)}
    .tire.crit{box-shadow:inset 0 0 0 2px rgba(251,113,133,.38)}
    .tire:hover{background:rgba(255,255,255,.10)}

    /* Tire thumbnails */
    .thumbRow{display:flex;gap:8px;align-items:center;margin-top:8px}
    .thumbs{display:flex;gap:6px;flex-wrap:wrap}
    .thumb{width:48px;height:36px;border-radius:10px;border:1px solid rgba(255,255,255,.14);background:rgba(255,255,255,.06);overflow:hidden;cursor:pointer;position:relative;flex:0 0 auto}
    .thumb img{width:100%;height:100%;object-fit:cover;display:block}
    .thumb::after{content:"";position:absolute;inset:0;background:linear-gradient(180deg,transparent,rgba(0,0,0,.2));pointer-events:none}
    .thumbLabel{font-size:12px;color:var(--muted);line-height:1.3}

    .tableWrap{margin-top:12px}
    table{width:100%;border-collapse:collapse;font-size:12px}
    thead{display:none}
    tbody tr{display:block;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05);border-radius:16px;padding:10px;margin-bottom:10px;cursor:pointer;overflow:hidden}
    tbody td{display:block;padding:5px 0}
    .rowLine{color:var(--muted);font-size:12px;line-height:1.35}
    .rowCols{display:flex;gap:6px;flex-wrap:wrap;margin-top:5px}

    .drawerOverlay{position:fixed;inset:0;background:rgba(0,0,0,.55);backdrop-filter:blur(4px);display:none;align-items:flex-end;z-index:30;padding:10px;padding-bottom:calc(10px + env(safe-area-inset-bottom))}
    .drawer{width:100%;border-radius:22px 22px 16px 16px;border:1px solid rgba(255,255,255,.16);background:linear-gradient(180deg,rgba(20,26,55,.96),rgba(10,16,32,.98));box-shadow:var(--shadow);padding:12px 12px 14px;max-height:85vh;overflow:auto}
    .grabber{width:44px;height:4px;border-radius:99px;background:rgba(255,255,255,.25);margin:2px auto 10px}
    .drawerTop{display:flex;justify-content:space-between;gap:12px;align-items:flex-start}
    .drawerTop h3{margin:0;font-size:14px;letter-spacing:.2px}
    .closeX{cursor:pointer;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.06);width:42px;height:42px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-size:16px;user-select:none;flex:0 0 auto}
    .drawerGrid{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .field{padding:12px;border-radius:16px;border:1px solid rgba(255,255,255,.10);background:rgba(255,255,255,.05)}
    .field .k{font-size:13px;color:var(--muted);line-height:1.3}
    .field .v{margin-top:6px;font-size:14px;line-height:1.3}
    .drawerActions{display:grid;grid-template-columns:1fr;gap:10px;margin-top:12px}
    .drawerActions .btn{width:100%}
    .footerHint{margin-top:16px;padding-top:12px;border-top:1px solid var(--border);font-size:13px;color:rgba(255,255,255,.9);line-height:1.45;max-width:52ch}
    .sectionTitle{font-size:14px;font-weight:600;color:var(--text);margin-bottom:4px}
    .sectionSort{font-size:13px;color:var(--muted);margin-bottom:12px;line-height:1.35}

    /* Photo viewer */
    .photoOverlay{position:fixed;inset:0;display:none;z-index:60;background:rgba(0,0,0,.78);backdrop-filter:blur(6px);padding:12px;padding-top:calc(12px + env(safe-area-inset-top));padding-bottom:calc(12px + env(safe-area-inset-bottom))}
    .photoWrap{height:100%;display:flex;flex-direction:column;gap:10px}
    .photoTop{display:flex;align-items:center;justify-content:space-between;gap:10px}
    .photoTitle{font-size:13px;color:var(--text);white-space:nowrap;overflow:hidden;text-overflow:ellipsis;flex:1;min-width:0}
    .photoNav{display:flex;gap:8px}
    .photoBtn{width:44px;height:44px;border-radius:14px;border:1px solid rgba(255,255,255,.18);background:rgba(255,255,255,.08);color:var(--text);display:flex;align-items:center;justify-content:center;font-size:18px;cursor:pointer;user-select:none}
    .photoBtn:active{transform:translateY(1px)}
    .photoCanvas{flex:1;border-radius:18px;border:1px solid rgba(255,255,255,.16);background:rgba(255,255,255,.04);overflow:hidden;display:flex;align-items:center;justify-content:center}
    .photoCanvas img{max-width:100%;max-height:100%;object-fit:contain;display:block}
    .photoDots{display:flex;justify-content:center;gap:8px;margin-top:2px}
    .pDot{width:7px;height:7px;border-radius:99px;background:rgba(255,255,255,.22);cursor:pointer}
    .pDot.on{background:rgba(255,255,255,.70)}

    /* Service & Warranty blocks */
    .svcBlock{margin-top:10px;padding:10px 12px;border-radius:14px;background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);overflow:hidden}
    .svcBlock .svcHead{display:flex;align-items:center;gap:8px;font-size:12px;font-weight:600;color:var(--accent1);flex-wrap:wrap;line-height:1.4}
    .svcBlock .svcHead svg{width:14px;height:14px;fill:currentColor;flex-shrink:0}
    .svcBlock .svcRow{margin-top:8px;display:flex;flex-wrap:wrap;gap:5px;font-size:11px;color:var(--muted)}
    .svcBlock .svcItem{padding:3px 7px;border-radius:6px;background:rgba(255,255,255,.06);max-width:100%;word-break:break-word}
    .svcBlock .svcItem.done{color:var(--ok)}
    .svcBlock .svcItem.rec{color:var(--warn)}
    .svcBtn{margin-top:8px;display:inline-flex;align-items:center;gap:6px;padding:6px 10px;border-radius:10px;background:rgba(255,255,255,.08);border:1px solid rgba(255,255,255,.12);color:var(--text);font-size:11px;cursor:pointer}
    .svcBtn:hover{background:rgba(255,255,255,.12)}
    .warrantyBadge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:8px;background:linear-gradient(135deg,rgba(46,204,113,.18),rgba(52,152,219,.18));border:1px solid rgba(46,204,113,.3);color:var(--ok);font-size:10px;font-weight:600}
    .warrantyBadge svg{width:11px;height:11px;fill:currentColor}
    .repairBadge{display:inline-flex;align-items:center;gap:4px;padding:3px 8px;border-radius:8px;background:rgba(241,196,15,.12);border:1px solid rgba(241,196,15,.25);color:#f1c40f;font-size:10px}

    /* –°–≤–µ—Ç–ª–∞—è —Ç–µ–º–∞ */
    html[data-theme="light"]{--bg:#eef2f7;--text:#0f172a;--muted:#475569;--border:#e2e8f0;--ok:#059669;--warn:#d97706;--crit:#dc2626;--accent1:rgba(59,130,246,.9);--accent2:rgba(124,58,237,.85);--shadow:0 4px 20px rgba(0,0,0,.08)}
    html[data-theme="light"] body{background:radial-gradient(1200px 600px at 20% -10%,rgba(59,130,246,.12),transparent 60%),radial-gradient(900px 500px at 90% 10%,rgba(168,85,247,.08),transparent 55%),radial-gradient(700px 500px at 40% 110%,rgba(16,185,129,.08),transparent 55%),#eef2f7}
    html[data-theme="light"] .card-base,.topbar{background:linear-gradient(180deg,#fff,#f8fafc);border-color:var(--border)}
    html[data-theme="light"] .logo{border-color:rgba(0,0,0,.08);box-shadow:0 4px 16px rgba(59,130,246,.2)}
    html[data-theme="light"] .btn{background:rgba(0,0,0,.04);border-color:var(--border)}
    html[data-theme="light"] .btn:hover{background:rgba(0,0,0,.07)}
    html[data-theme="light"] .btn.primary{background:linear-gradient(135deg,var(--accent1),var(--accent2));border-color:rgba(255,255,255,.3);color:#fff}
    html[data-theme="light"] .pill{background:rgba(0,0,0,.03);border-color:var(--border)}
    html[data-theme="light"] select option{background:#fff;color:var(--text)}
    html[data-theme="light"] input[type="search"]::placeholder{color:var(--muted)}
    html[data-theme="light"] .cardHeader{border-bottom-color:var(--border)}
    html[data-theme="light"] .tab{background:rgba(0,0,0,.04);border-color:var(--border)}
    html[data-theme="light"] .tab.active{background:rgba(59,130,246,.1);border-color:rgba(59,130,246,.35)}
    html[data-theme="light"] .kpi{background:rgba(0,0,0,.03);border-color:var(--border)}
    html[data-theme="light"] .kpi.clickable:hover{background:rgba(0,0,0,.05)}
    html[data-theme="light"] .chip{background:rgba(0,0,0,.04);border-color:var(--border)}
    html[data-theme="light"] .chip.clickable:hover{background:rgba(0,0,0,.06)}
    html[data-theme="light"] .chip.clickable.active{background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.4)}
    html[data-theme="light"] .dot{box-shadow:0 0 0 3px rgba(0,0,0,.06)}
    html[data-theme="light"] .dot.ok{box-shadow:0 0 0 3px rgba(5,150,105,.2)}
    html[data-theme="light"] .dot.warn{box-shadow:0 0 0 3px rgba(217,119,6,.2)}
    html[data-theme="light"] .dot.crit{box-shadow:0 0 0 3px rgba(220,38,38,.2)}
    html[data-theme="light"] .badge{background:rgba(0,0,0,.06);border-color:var(--border)}
    html[data-theme="light"] .badge.ok{background:rgba(5,150,105,.12);border-color:rgba(5,150,105,.3)}
    html[data-theme="light"] .badge.warn{background:rgba(217,119,6,.12);border-color:rgba(217,119,6,.3)}
    html[data-theme="light"] .badge.crit{background:rgba(220,38,38,.12);border-color:rgba(220,38,38,.3)}
    html[data-theme="light"] .badge.best{background:rgba(59,130,246,.12);border-color:rgba(59,130,246,.35);color:#2563eb}
    html[data-theme="light"] .item{background:rgba(0,0,0,.03);border-color:var(--border)}
    html[data-theme="light"] .item:hover{background:rgba(0,0,0,.05)}
    html[data-theme="light"] .vehicleCard,.vehPhoto,.tires,.tire{background:rgba(0,0,0,.03);border-color:var(--border)}
    html[data-theme="light"] .tire:hover{background:rgba(0,0,0,.06)}
    html[data-theme="light"] .thumb{background:rgba(0,0,0,.04);border-color:var(--border)}
    html[data-theme="light"] tbody tr{background:rgba(0,0,0,.02);border-color:var(--border)}
    html[data-theme="light"] .drawer{background:linear-gradient(180deg,#f8fafc,#fff);border-color:var(--border)}
    html[data-theme="light"] .closeX,.field{background:rgba(0,0,0,.04);border-color:var(--border)}
    html[data-theme="light"] .grabber{background:var(--muted)}
    html[data-theme="light"] .photoOverlay{background:rgba(0,0,0,.85)}
    html[data-theme="light"] .photoBtn,.photoCanvas,.pDot{background:rgba(255,255,255,.9);border-color:var(--border);color:var(--text)}
    html[data-theme="light"] .pDot.on{background:var(--accent1)}
    html[data-theme="light"] .productIntro{background:rgba(0,0,0,.03);border-color:var(--border)}
    html[data-theme="light"] .footerHint{color:var(--muted)}

    /* Bottom Navigation ‚Äî Mobile */
    .bottomNav{position:fixed;bottom:0;left:0;right:0;z-index:50;display:flex;justify-content:space-around;align-items:stretch;background:linear-gradient(180deg,rgba(15,20,40,.94),rgba(8,12,28,.98));backdrop-filter:blur(14px);border-top:1px solid var(--border);padding:4px 8px;padding-bottom:calc(4px + env(safe-area-inset-bottom))}
    .bnItem{flex:1;display:flex;flex-direction:column;align-items:center;gap:3px;background:none;border:none;color:var(--muted);padding:6px 4px;cursor:pointer;border-radius:12px;transition:color .15s,background .15s;-webkit-tap-highlight-color:transparent;user-select:none}
    .bnItem .bnIcon{font-size:20px;line-height:1}
    .bnItem .bnLabel{font-size:10px;line-height:1.2;white-space:nowrap;letter-spacing:.2px}
    .bnItem.active{color:var(--accent1);background:rgba(59,130,246,.1)}
    .bnItem:active{transform:scale(.95)}
    html[data-theme="light"] .bottomNav{background:linear-gradient(180deg,rgba(248,250,252,.96),rgba(255,255,255,.98));border-top-color:var(--border)}
    html[data-theme="light"] .bnItem.active{color:#2563eb;background:rgba(59,130,246,.1)}

    @media(min-width:980px){
      body{padding:18px}
      .topbar{flex-direction:column;align-items:stretch;justify-content:flex-start;padding:16px;top:12px}
      .topRow{align-items:center}
      .controls{display:grid;grid-template-columns:160px minmax(280px,1fr) auto;align-items:center;gap:12px}
      .controlsActions{justify-content:flex-end}
      #filtersToggle,#quickActionsToggle{display:none}
      .bottomNav{display:none}
      .productIntro{margin-top:0;max-width:760px}
      .grid{grid-template-columns:1.2fr .8fr;gap:14px;margin-top:14px}
      .cardHeader{flex-direction:row;align-items:flex-start;justify-content:space-between}
      .headerTop{flex:1}
      .kpiRow{grid-template-columns:repeat(4,1fr)}
      thead{display:table-header-group}
      tbody tr{display:table-row;border:none;background:transparent;padding:0;margin:0;border-radius:0}
      tbody td{display:table-cell;padding:10px 8px;border-bottom:1px solid rgba(255,255,255,.08);vertical-align:top}
      .tableWrap{overflow:auto}
      .drawerActions{grid-template-columns:auto auto auto}
      .drawerActions .btn{width:auto}
      .drawerGrid{grid-template-columns:1fr 1fr}
      .thumb{width:56px;height:40px}
    }
  </style>
  <script>
    (function(){ var t = localStorage.getItem('sg-theme'); if (t === 'light') document.documentElement.setAttribute('data-theme','light'); })();
  </script>
</head>
<body>
  <div class="wrap">
    <div class="topbar card-base">
      <div class="topRow">
        <div class="brand">
          <div class="logo" aria-hidden="true"></div>
          <div class="brandText">
            <h1>SmartGuma</h1>
            <p>–¶–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –ø–æ –ø–∞—Ä–∫—É, –¢–° –∏ —à–∏–Ω–∞–º</p>
          </div>
        </div>
        <div class="topActions">
          <button class="btn icon themeToggleBtn" aria-label="–¢–µ–º–∞" title="–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å —Ç–µ–º—É">üåô</button>
          <button class="btn icon" id="filtersToggle" aria-label="–§–∏–ª—å—Ç—Ä—ã" title="–§–∏–ª—å—Ç—Ä—ã">‚ò∞</button>
          <button class="btn icon" id="quickActionsToggle" aria-label="–î–µ–π—Å—Ç–≤–∏—è" title="–î–µ–π—Å—Ç–≤–∏—è">‚ö°</button>
        </div>
      </div>

      <div class="controls" id="controls">
        <div class="pill">
          <label for="statusSel">–°—Ç–∞—Ç—É—Å</label>
          <select id="statusSel">
            <option value="all">–í—Å–µ</option>
            <option value="crit">–ö—Ä–∏—Ç–∏—á–Ω–æ</option>
            <option value="warn">–í–Ω–∏–º–∞–Ω–∏–µ</option>
            <option value="ok">–ù–æ—Ä–º–∞</option>
          </select>
        </div>
        <div class="pill">
          <label for="q">–ü–æ–∏—Å–∫</label>
          <input id="q" type="search" placeholder="–¢–°, —à–∏–Ω–∞, –±—Ä–µ–Ω–¥, —Å–µ—Ä–∏–π–Ω–∏–∫, –∏–Ω—Å–ø–µ–∫—Ü–∏—è...">
        </div>
        <div class="controlsActions">
          <button class="btn primary" id="createWO">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å</button>
          <button class="btn" id="clearBtn">–°–±—Ä–æ—Å</button>
        </div>
      </div>
      <div class="productIntro">
        <div class="row"><strong>–í—ã –≤–∏–¥–∏—Ç–µ:</strong> –∏—Å—Ç–æ—Ä–∏—è —à–∏–Ω, –∏–Ω—Å–ø–µ–∫—Ü–∏–∏ (–≥–ª—É–±–∏–Ω–∞, –ø—Ä–æ–±–µ–≥–∏, —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ), —Å–æ—Å—Ç–æ—è–Ω–∏–µ –ø–æ –¢–° –∏ –ø–∞—Ä–∫—É, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏, —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ ¬´–±—ã–ª–æ / —Å—Ç–∞–ª–æ¬ª.</div>
        <div class="row"><strong>–í—ã –º–æ–∂–µ—Ç–µ:</strong> —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –∑–∞–º–µ–Ω–∏—Ç—å –∏–ª–∏ —Å–ø–∏—Å–∞—Ç—å —à–∏–Ω—É, –ø–æ–¥–∞—Ç—å —Ä–µ–∫–ª–∞–º–∞—Ü–∏—é, –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å, –∑–∞–∫–∞–∑–∞—Ç—å —à–∏–Ω—ã, —Ä–∞–±–æ—Ç–∞—Ç—å —Å –∂–∞–ª–æ–±–∞–º–∏ –∏ —Å—Ç–∞—Ç—É—Å–∞–º–∏.</div>
      </div>
    </div>

    <div class="grid">
      <div class="card card-base">
        <div class="cardHeader">
          <div class="headerTop">
            <div>
              <h2 id="mainTitle">–û–±–∑–æ—Ä –ø–∞—Ä–∫–∞</h2>
              <div class="sub" id="mainSub">–°–æ—Å—Ç–æ—è–Ω–∏–µ —à–∏–Ω –ø–æ –¢–°, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏ ¬∑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ‚Äî</div>
            </div>
            <div class="tabs" role="tablist" aria-label="–†–∞–∑–¥–µ–ª—ã">
              <div class="tab active" data-tab="fleet" role="tab" aria-selected="true">–ü–∞—Ä–∫</div>
              <div class="tab" data-tab="vehicle" role="tab" aria-selected="false">–¢–°</div>
              <div class="tab" data-tab="tires" role="tab" aria-selected="false">–®–∏–Ω—ã</div>
            </div>
          </div>
        </div>

        <div class="cardBody">
          <div id="viewFleet">
            <div class="kpiRow" id="kpis"></div>
            <div class="filterChips" id="filterChips">
              <span class="chip clickable" data-filter="ok"><span class="dot ok"></span><span id="chipOk">‚Äî</span></span>
              <span class="chip clickable" data-filter="warn"><span class="dot warn"></span><span id="chipWarn">‚Äî</span></span>
              <span class="chip clickable" data-filter="crit"><span class="dot crit"></span><span id="chipCrit">‚Äî</span></span>
            </div>
            <div class="prioritySection" style="margin-top:16px">
              <div class="sectionTitle">–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (30 –¥–Ω–µ–π)</div>
              <div class="sectionSort">–°–æ—Ä—Ç–∏—Ä–æ–≤–∫–∞: —Ä–∏—Å–∫ ‚Üí —Å—Ä–æ—á–Ω–æ—Å—Ç—å ‚Üí —Å—Ç–æ–∏–º–æ—Å—Ç—å. –ó–∞–º–µ–Ω–∏—Ç–µ, —Å–æ–≥–ª–∞—Å—É–π—Ç–µ —Å–µ—Ä–≤–∏—Å –∏–ª–∏ –ø–æ–¥–∞–π—Ç–µ —Ä–µ–∫–ª–∞–º–∞—Ü–∏—é.</div>
              <div class="list" id="priorityList"></div>
            </div>
          </div>

          <div id="viewVehicle" hidden>
            <div class="vehicleWrap" id="vehicleWrap"></div>
          </div>

          <div id="viewTires" hidden>
            <div style="display:flex;justify-content:space-between;align-items:flex-start;gap:10px;flex-wrap:wrap">
              <div>
                <div class="sectionTitle">–†–µ–µ—Å—Ç—Ä —à–∏–Ω</div>
                <div class="sectionSort">–ò—Å—Ç–æ—Ä–∏—è, –∏–Ω—Å–ø–µ–∫—Ü–∏–∏, —Ñ–æ—Ç–æ. –ü–æ–¥—Å–≤–µ—Ç–∫–∞ ‚Äî –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –∫–º.</div>
              </div>
              <div class="chip"><span class="dot"></span><span id="tiresCount">‚Äî</span></div>
            </div>
            <div class="tableWrap">
              <table>
                <thead>
                  <tr style="text-align:left;color:var(--muted)">
                    <th>–®–∏–Ω–∞</th><th>–¢–°</th><th>–ü–æ–∑–∏—Ü–∏—è</th><th>–ü—Ä–æ–±–µ–≥/–°—Ç–æ–∏–º–æ—Å—Ç—å</th><th>–§–æ—Ç–æ</th>
                  </tr>
                </thead>
                <tbody id="tiresTable"></tbody>
              </table>
            </div>
          </div>
        </div>
      </div>

      <div class="card card-base">
        <div class="cardHeader">
          <div class="headerTop">
            <div>
              <h2>–ë–ª–∏–∂–∞–π—à–∏–µ —Å–æ–±—ã—Ç–∏—è</h2>
              <div class="sub">–ò–Ω—Å–ø–µ–∫—Ü–∏–∏, –ø–ª–∞–Ω–æ–≤—ã–µ —Ç–æ—á–∫–∏ –∫–æ–Ω—Ç—Ä–æ–ª—è, –∑–∞–ø–∏—Å—å –Ω–∞ —Å–µ—Ä–≤–∏—Å –∏ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ –ø–æ SLA</div>
            </div>
            <span class="chip"><span class="dot"></span><span id="eventsCount">‚Äî</span></span>
          </div>
        </div>
        <div class="cardBody">
          <div class="list" id="events"></div>
          <div class="footerHint">
            SmartGuma ‚Äî —Ü–∏—Ñ—Ä–æ–≤–æ–π –ø–æ–º–æ—â–Ω–∏–∫ –≤–ª–∞–¥–µ–ª—å—Ü–∞–º –∞–≤—Ç–æ–ø–∞—Ä–∫–æ–≤: —Å–æ—Å—Ç–æ—è–Ω–∏–µ —à–∏–Ω, –∏–Ω—Å–ø–µ–∫—Ü–∏–∏, —Å–µ—Ä–≤–∏—Å, –∑–∞–º–µ–Ω—ã, —Ä–µ–∫–ª–∞–º–∞—Ü–∏–∏, –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ –∏ –∑–∞–∫—É–ø–∫–∞. UI-–º–∞–∫–µ—Ç.
          </div>
        </div>
      </div>
    </div>
  </div>

  <nav class="bottomNav" id="bottomNav">
    <button class="bnItem active" data-tab="fleet"><span class="bnIcon">üìä</span><span class="bnLabel">–ü–∞—Ä–∫</span></button>
    <button class="bnItem" data-tab="vehicle"><span class="bnIcon">üöõ</span><span class="bnLabel">–¢–°</span></button>
    <button class="bnItem" data-tab="tires"><span class="bnIcon">üõû</span><span class="bnLabel">–®–∏–Ω—ã</span></button>
  </nav>

  <div class="drawerOverlay" id="drawerOverlay" role="dialog" aria-modal="true" aria-label="–ö–∞—Ä—Ç–æ—á–∫–∞">
    <div class="drawer">
      <div class="grabber" aria-hidden="true"></div>
      <div class="drawerTop">
        <div style="min-width:0">
          <h3 id="drawerTitle">–ö–∞—Ä—Ç–æ—á–∫–∞</h3>
          <div class="sub" id="drawerSub" style="white-space:nowrap;overflow:hidden;text-overflow:ellipsis">‚Äî</div>
        </div>
        <div class="closeX" id="drawerClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</div>
      </div>
      <div style="margin-top:10px;display:flex;gap:10px;flex-wrap:wrap">
        <span class="chip" id="drawerStatusChip"><span class="dot"></span><span id="drawerStatusText">‚Äî</span></span>
        <span class="chip"><span class="dot"></span><span id="drawerUpdated">‚Äî</span></span>
      </div>
      <div class="drawerGrid" id="drawerFields"></div>
      <div class="drawerActions">
        <button class="btn primary" id="drawerAction1">–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å</button>
        <button class="btn" id="drawerAction2">–§–æ—Ç–æ / –û—Ç–∫—Ä—ã—Ç—å</button>
        <button class="btn" id="drawerAction3">–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å</button>
      </div>
      <div class="footerHint">–î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è: —Å–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å, –∑–∞–º–µ–Ω–∏—Ç—å/—Å–ø–∏—Å–∞—Ç—å —à–∏–Ω—É, –ø–æ–¥–∞—Ç—å —Ä–µ–∫–ª–∞–º–∞—Ü–∏—é, –∑–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å, –∑–∞–∫–∞–∑–∞—Ç—å —à–∏–Ω—ã, –∂–∞–ª–æ–±—ã –∏ —Å—Ç–∞—Ç—É—Å—ã.</div>
    </div>
  </div>

  <div class="photoOverlay" id="photoOverlay" role="dialog" aria-modal="true" aria-label="–§–æ—Ç–æ">
    <div class="photoWrap">
      <div class="photoTop">
        <div class="photoTitle" id="photoTitle">–§–æ—Ç–æ</div>
        <div class="photoNav">
          <div class="photoBtn" id="photoPrev" aria-label="–ü—Ä–µ–¥—ã–¥—É—â–µ–µ">‚Äπ</div>
          <div class="photoBtn" id="photoNext" aria-label="–°–ª–µ–¥—É—é—â–µ–µ">‚Ä∫</div>
          <div class="photoBtn" id="photoClose" aria-label="–ó–∞–∫—Ä—ã—Ç—å">√ó</div>
        </div>
      </div>
      <div class="photoCanvas"><img id="photoImg" alt="–§–æ—Ç–æ"></div>
      <div class="photoDots" id="photoDots"></div>
    </div>
  </div>

  <script>
  (function(){
    'use strict';

    // Demo photos
    const TIRE_PHOTOS = [
      "https://i.ibb.co/nxKcSjg/2440934-570x570.jpg",
      "https://i.ibb.co/QjrdRvWq/67732bd7878248a3a24c4f8baf0117f8.png",
      "https://i.ibb.co/JFk3Z3dh/lanvigator-mile-max-228x228.jpg"
    ];
    const TRUCK_PHOTOS = [
      "https://images.unsplash.com/photo-1519003722824-194d4455a60c?w=600",
      "https://images.unsplash.com/photo-1616432043562-3671ea2e5242?w=600"
    ];

    // Mock data
    const db = {
      clients: [{
        id:"c1", name:"–ö–ª–∏–µ–Ω—Ç A (50 –¢–°)", updatedAt:"2026-01-06 09:12",
        fleet:{vehicles:8,tires:96,ok:68,warn:20,crit:8,forecastCost30:186000,downtimeRisk30:"–°—Ä–µ–¥–Ω–∏–π",sla:"24‚Äì48 —á–∞—Å–æ–≤",
          costs:{
            maintenance:42000, maintenanceItems:["–¢–û MAN TGX ‚Äî 28 000 –≥—Ä–Ω","–¢–û DAF XF ‚Äî 14 000 –≥—Ä–Ω"],
            repair:72000, repairItems:["–ó–∞–º–µ–Ω–∞ —à–∏–Ω –æ—Å—å 3 (MAN) ‚Äî 58 000 –≥—Ä–Ω","–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ + –ø–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ ‚Äî 14 000 –≥—Ä–Ω"],
            tires:72000, tiresCount:3, tiresItems:["Goodyear 315/80 R22.5 ‚Äî 24 000 –≥—Ä–Ω √ó 2","Bridgestone 315/80 R22.5 ‚Äî 24 000 –≥—Ä–Ω √ó 1"]
          }},
        vehicles:[
          {id:"v1",title:"MAN TGX 18.500",plate:"AA 1234 XX",photos:[TRUCK_PHOTOS[0],TRUCK_PHOTOS[1]],status:"warn",lastInspection:"2026-01-04",
            driver:{name:"–ò–≥–æ—Ä—å –ö.",rating:4.2,last30:4.0,notes:"–†–µ–∑–∫–∏–µ —Ç–æ—Ä–º–æ–∂–µ–Ω–∏—è"},
            notes:"–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π –∏–∑–Ω–æ—Å –Ω–∞ –∑–∞–¥–Ω–µ–π –æ—Å–∏",
            service:{
              lastVisit:"2025-12-20",
              station:"–°–¢–û ¬´–ê–≤—Ç–æ–°–µ—Ä–≤–∏—Å+¬ª",
              recommended:["–ó–∞–º–µ–Ω–∞ —Ç–æ—Ä–º–æ–∑–Ω—ã—Ö –∫–æ–ª–æ–¥–æ–∫","–î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞ –ø–æ–¥–≤–µ—Å–∫–∏","–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞ –∫–æ–ª—ë—Å"],
              done:["–ó–∞–º–µ–Ω–∞ –º–∞—Å–ª–∞","–ó–∞–º–µ–Ω–∞ —Ñ–∏–ª—å—Ç—Ä–æ–≤","–ü—Ä–æ–≤–µ—Ä–∫–∞ —Ö–æ–¥–æ–≤–æ–π"],
              reportId:"INS-2025-1220-MAN"
            },
            axles:[
              {name:"–û—Å—å 1",tires:[
                {id:"t1",code:"T-0001",brand:"Michelin",serialNo:"MIC-7A19-001",pos:"1L",tread:7.2,risk:"ok",replaceETA:"‚Äî",pressure:"–ù–æ—Ä–º–∞",wear:"–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:38000,kmRun:92000,cost:18500,photos:[TIRE_PHOTOS[0],TIRE_PHOTOS[1]],
                  product:true,warranty:{until:"2027-06-15",type:"–ì–∞—Ä–∞–Ω—Ç–∏—è 3 –≥–æ–¥–∞",services:["–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞","–®–∏–Ω–æ–º–æ–Ω—Ç–∞–∂ —Å–æ —Å–∫–∏–¥–∫–æ–π 20%"]}},
                {id:"t2",code:"T-0002",brand:"Michelin",serialNo:"MIC-7A19-002",pos:"1R",tread:6.9,risk:"ok",replaceETA:"‚Äî",pressure:"–ù–æ—Ä–º–∞",wear:"–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:36000,kmRun:88000,cost:18500,photos:[TIRE_PHOTOS[1]],
                  product:true,warranty:{until:"2027-06-15",type:"–ì–∞—Ä–∞–Ω—Ç–∏—è 3 –≥–æ–¥–∞",services:["–ë–µ—Å–ø–ª–∞—Ç–Ω–∞—è –±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞"]}}
              ]},
              {name:"–û—Å—å 2",tires:[
                {id:"t3",code:"T-0003",brand:"Bridgestone",serialNo:"BRI-3D55-003",pos:"2L",tread:4.0,risk:"warn",replaceETA:"30‚Äì45 –¥–Ω–µ–π",pressure:"–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ",wear:"–ü–ª–µ—á–µ–≤–æ–π –∏–∑–Ω–æ—Å",kmLeft:12000,kmRun:74000,cost:16200,photos:[TIRE_PHOTOS[2],TIRE_PHOTOS[0]],
                  repairs:[{date:"2025-11-10",type:"–í—É–ª–∫–∞–Ω–∏–∑–∞—Ü–∏—è",cost:850,station:"–®–∏–Ω–æ–°–µ—Ä–≤–∏—Å"}]},
                {id:"t4",code:"T-0004",brand:"Bridgestone",serialNo:"BRI-3D55-004",pos:"2R",tread:3.6,risk:"warn",replaceETA:"30‚Äì45 –¥–Ω–µ–π",pressure:"–û—Ç–∫–ª–æ–Ω–µ–Ω–∏–µ",wear:"–ü–ª–µ—á–µ–≤–æ–π –∏–∑–Ω–æ—Å",kmLeft:9000,kmRun:71000,cost:16200,photos:[TIRE_PHOTOS[2]]}
              ]},
              {name:"–û—Å—å 3",tires:[
                {id:"t5",code:"T-0005",brand:"Goodyear",serialNo:"GDY-9F01-005",pos:"3L",tread:2.2,risk:"crit",replaceETA:"7‚Äì14 –¥–Ω–µ–π",pressure:"–ù–∏–∑–∫–æ–µ",wear:"–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:2500,kmRun:61000,cost:14500,photos:[TIRE_PHOTOS[0],TIRE_PHOTOS[2]],
                  repairs:[{date:"2025-08-22",type:"–õ–∞—Ç–∫–∞ –±–æ–∫–æ–≤–æ–≥–æ –ø–æ—Ä–µ–∑–∞",cost:1200,station:"–°–¢–û –ö–æ–ª–µ—Å–æ"},{date:"2025-10-05",type:"–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞",cost:350,station:"–ê–≤—Ç–æ–°–µ—Ä–≤–∏—Å+"}]},
                {id:"t6",code:"T-0006",brand:"Goodyear",serialNo:"GDY-9F01-006",pos:"3R",tread:2.5,risk:"crit",replaceETA:"7‚Äì14 –¥–Ω–µ–π",pressure:"–ù–∏–∑–∫–æ–µ",wear:"–ù–µ—Ä–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:3200,kmRun:64000,cost:14500,photos:[TIRE_PHOTOS[1]]}
              ]}
            ]},
          {id:"v2",title:"DAF XF 480",plate:"AI 7788 BC",photos:[TRUCK_PHOTOS[1]],status:"ok",lastInspection:"2026-01-05",
            driver:{name:"–°–µ—Ä–≥—ñ–π –ú.",rating:4.7,last30:4.8,notes:"–ê–∫–∫—É—Ä–∞—Ç–Ω–∞—è —ç–∫—Å–ø–ª—É–∞—Ç–∞—Ü–∏—è"},
            notes:"–ü–æ–∫–∞–∑–∞—Ç–µ–ª–∏ –≤ –Ω–æ—Ä–º–µ",
            axles:[
              {name:"–û—Å—å 1",tires:[
                {id:"t7",code:"T-0010",brand:"Continental",serialNo:"CON-2K18-010",pos:"1L",tread:7.8,risk:"ok",replaceETA:"‚Äî",pressure:"–ù–æ—Ä–º–∞",wear:"–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:42000,kmRun:98000,cost:17600,photos:[TIRE_PHOTOS[2]],
                  product:true,warranty:{until:"2028-02-01",type:"–ì–∞—Ä–∞–Ω—Ç–∏—è 5 –ª–µ—Ç",services:["–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –æ—Ç –ø—Ä–æ–∫–æ–ª–æ–≤","–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂","–°–µ–∑–æ–Ω–Ω–æ–µ —Ö—Ä–∞–Ω–µ–Ω–∏–µ"]}},
                {id:"t8",code:"T-0011",brand:"Continental",serialNo:"CON-2K18-011",pos:"1R",tread:7.6,risk:"ok",replaceETA:"‚Äî",pressure:"–ù–æ—Ä–º–∞",wear:"–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:40000,kmRun:102000,cost:17600,photos:[TIRE_PHOTOS[0]],
                  product:true,warranty:{until:"2028-02-01",type:"–ì–∞—Ä–∞–Ω—Ç–∏—è 5 –ª–µ—Ç",services:["–°—Ç—Ä–∞—Ö–æ–≤–∞–Ω–∏–µ –æ—Ç –ø—Ä–æ–∫–æ–ª–æ–≤","–ë–µ—Å–ø–ª–∞—Ç–Ω—ã–π —à–∏–Ω–æ–º–æ–Ω—Ç–∞–∂"]}}
              ]},
              {name:"–û—Å—å 2",tires:[
                {id:"t9",code:"T-0012",brand:"Hankook",serialNo:"HNK-0P77-012",pos:"2L",tread:6.2,risk:"ok",replaceETA:"‚Äî",pressure:"–ù–æ—Ä–º–∞",wear:"–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:28000,kmRun:83000,cost:12800,photos:[TIRE_PHOTOS[1]],
                  repairs:[{date:"2025-09-18",type:"–ë–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∫–∞",cost:300,station:"DAF-–°–µ—Ä–≤–∏—Å"}]},
                {id:"t10",code:"T-0013",brand:"Hankook",serialNo:"HNK-0P77-013",pos:"2R",tread:6.0,risk:"ok",replaceETA:"‚Äî",pressure:"–ù–æ—Ä–º–∞",wear:"–†–∞–≤–Ω–æ–º–µ—Ä–Ω—ã–π",kmLeft:26000,kmRun:85000,cost:12800,photos:[TIRE_PHOTOS[2]]}
              ]}
            ]}
        ],
        actions:[
          {id:"a1",severity:"crit",title:"–ó–∞–º–µ–Ω–∞ —à–∏–Ω –Ω–∞ –æ—Å–∏ 3 (MAN TGX AA 1234 XX)",tags:["–†–∏—Å–∫ –ø—Ä–æ—Å—Ç–æ—è","SLA 48—á"],desc:"–î–≤–µ —à–∏–Ω—ã –≤ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–æ–π –∑–æ–Ω–µ. –ó–∞–º–µ–Ω–∞ 7‚Äì14 –¥–Ω–µ–π.",cost:72000,due:"–î–æ 2026-01-20"},
          {id:"a2",severity:"warn",title:"–ü–µ—Ä–µ—Å—Ç–∞–Ω–æ–≤–∫–∞ + –∫–æ–Ω—Ç—Ä–æ–ª—å –¥–∞–≤–ª–µ–Ω–∏—è (MAN TGX)",tags:["–°–Ω–∏–∂–µ–Ω–∏–µ –∏–∑–Ω–æ—Å–∞"],desc:"–ü–ª–µ—á–µ–≤–æ–π –∏–∑–Ω–æ—Å –Ω–∞ –æ—Å–∏ 2. –ö–æ—Ä—Ä–µ–∫—Ç–∏—Ä–æ–≤–∫–∞ –¥–∞–≤–ª–µ–Ω–∏—è.",cost:8500,due:"–î–æ 2026-01-25"},
          {id:"a3",severity:"warn",title:"–ü—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∏–∑–∫–æ–≥–æ –¥–∞–≤–ª–µ–Ω–∏—è (MAN TGX)",tags:["–ü—Ä–æ—Ñ–∏–ª–∞–∫—Ç–∏–∫–∞"],desc:"–ù–∏–∑–∫–æ–µ –¥–∞–≤–ª–µ–Ω–∏–µ –Ω–∞ –æ—Å–∏ 3. –î–∏–∞–≥–Ω–æ—Å—Ç–∏–∫–∞.",cost:2500,due:"–î–æ 2026-01-18"}
        ],
        events:[
          {id:"e1",severity:"warn",title:"–ü–ª–∞–Ω–æ–≤–∞—è –ò–ö-–∏–Ω—Å–ø–µ–∫—Ü–∏—è (DAF XF 480)",desc:"–ò–Ω—Å–ø–µ–∫—Ü–∏—è –ø–æ –≥—Ä–∞—Ñ–∏–∫—É.",when:"2026-01-12"},
          {id:"e2",severity:"crit",title:"–°–ª–æ—Ç —Å–µ—Ä–≤–∏—Å–∞ –ø–æ SLA (MAN TGX)",desc:"–†–µ–∑–µ—Ä–≤ —Å–ª–æ—Ç–∞ –¥–ª—è –∑–∞–º–µ–Ω –ø–æ –æ—Å–∏ 3.",when:"2026-01-10"},
          {id:"e3",severity:"warn",title:"–û—Ç—á—ë—Ç –ø–æ –ø–∞—Ä–∫—É",desc:"–ú–µ—Å—è—á–Ω–∞—è —Å–≤–æ–¥–∫–∞.",when:"2026-01-31"}
        ]
      }]
    };

    // Utils
    const $ = id => document.getElementById(id);
    const esc = s => String(s).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;");
    const fmtUAH = n => new Intl.NumberFormat("uk-UA").format(Math.round(n)) + " –≥—Ä–Ω";
    const fmtKM = n => new Intl.NumberFormat("uk-UA").format(Math.round(n)) + " –∫–º";
    const fmtK = n => (Math.round(n/100)/10).toFixed(1) + " —Ç–∏—Å";
    const fmtCpk = n => isFinite(n) && n < Infinity ? n.toFixed(2) + " –≥—Ä–Ω/–∫–º" : "‚Äî";
    const bySev = s => s==="crit"?0:s==="warn"?1:2;
    const sevLabel = s => s==="crit"?"–ö—Ä–∏—Ç–∏—á–Ω–æ":s==="warn"?"–í–Ω–∏–º–∞–Ω–∏–µ":"–ù–æ—Ä–º–∞";
    const sevClass = s => s==="crit"?"crit":s==="warn"?"warn":"ok";

    const cpk = t => (t.kmRun && t.cost && t.kmRun > 0) ? t.cost / t.kmRun : Infinity;

    const starsHtml = r => {
      const on = Math.round(Math.max(0,Math.min(5,r)));
      return Array.from({length:5},(_,i)=>`<span class="star ${i<on?"on":""}">‚òÖ</span>`).join("");
    };

    function collectTires(client) {
      const out = [];
      for (const v of client.vehicles)
        for (const ax of v.axles)
          for (const t of ax.tires)
            out.push({...t, cpk:cpk(t), vId:v.id, vTitle:v.title, plate:v.plate, axle:ax.name, driver:v.driver, vPhotos:v.photos||[], vService:v.service});
      return out;
    }

    function getBestSet(tires) {
      const valid = tires.filter(t => isFinite(t.cpk) && t.cpk < Infinity);
      if (!valid.length) return new Set();
      valid.sort((a,b) => a.cpk - b.cpk);
      const n = Math.max(1, Math.ceil(valid.length * 0.2));
      return new Set(valid.slice(0,n).map(t => t.id));
    }

    // State
    const state = {clientId:db.clients[0].id, tab:"fleet", status:"all", q:""};
    let cachedClient = null, cachedTires = null, bestSet = new Set();
    let drawerCtx = {type:null, photos:[], title:""};
    let photoState = {open:false, title:"", photos:[], idx:0};

    function getClient() {
      if (!cachedClient || cachedClient.id !== state.clientId) {
        cachedClient = db.clients.find(c => c.id === state.clientId);
        cachedTires = collectTires(cachedClient);
        bestSet = getBestSet(cachedTires);
      }
      return cachedClient;
    }
    function getTires() { getClient(); return cachedTires; }

    // DOM
    const els = {};
    ['clientSel','statusSel','q','mainTitle','mainSub','kpis','chipOk','chipWarn','chipCrit',
     'priorityList','events','eventsCount','viewFleet','viewVehicle','viewTires','vehicleWrap','tiresTable','tiresCount',
     'drawerOverlay','drawerClose','drawerTitle','drawerSub','drawerStatusChip','drawerUpdated','drawerFields',
     'controls','filtersToggle','quickActionsToggle','clearBtn','drawerAction1','drawerAction2','drawerAction3','bottomNav',
     'photoOverlay','photoTitle','photoImg','photoDots','photoPrev','photoNext','photoClose'].forEach(id => els[id] = $(id));

    // Init
    function init() {
      if (els.clientSel) {
        els.clientSel.innerHTML = db.clients.map(c => `<option value="${c.id}">${esc(c.name)}</option>`).join("");
        els.clientSel.value = state.clientId;
      }

      document.querySelector('.tabs').addEventListener('click', e => {
        const tab = e.target.closest('.tab');
        if (!tab) return;
        switchTab(tab.dataset.tab);
      });

      if (els.clientSel) els.clientSel.addEventListener('change', e => { state.clientId = e.target.value; cachedClient = null; render(); });
      els.statusSel.addEventListener('change', e => { state.status = e.target.value; updateFilterChipsUI(); render(); });
      els.q.addEventListener('input', debounce(e => { state.q = e.target.value.trim().toLowerCase(); render(); }, 150));
      els.clearBtn.addEventListener('click', () => { state.status = "all"; state.q = ""; els.statusSel.value = "all"; els.q.value = ""; updateFilterChipsUI(); render(); });

      // Clickable KPIs and filter chips
      $('kpis').addEventListener('click', e => {
        const kpi = e.target.closest('.kpi[data-go]');
        if (kpi) { switchTab(kpi.dataset.go); return; }
        
        const costsKpi = e.target.closest('.kpi[data-action="costs"]');
        if (costsKpi) { showCostsDrawer(); return; }
      });
      $('filterChips').addEventListener('click', e => {
        const chip = e.target.closest('.chip[data-filter]');
        if (chip) {
          const filter = chip.dataset.filter;
          // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–∞ (–ø–æ–≤—Ç–æ—Ä–Ω—ã–π –∫–ª–∏–∫ - —Å–±—Ä–æ—Å)
          state.status = state.status === filter ? "all" : filter;
          els.statusSel.value = state.status;
          updateFilterChipsUI();
          render();
          return;
        }
        const goChip = e.target.closest('.chip[data-go]');
        if (goChip) switchTab(goChip.dataset.go);
      });

      let filtersOpen = false;
      const mq = window.matchMedia("(max-width:979px)");
      const updateFilters = () => els.controls.classList.toggle('controlsCollapsed', mq.matches && !filtersOpen);
      els.filtersToggle.addEventListener('click', () => { filtersOpen = !filtersOpen; updateFilters(); });
      // Theme toggle (all instances)
      function toggleTheme() {
        const html = document.documentElement;
        const isLight = html.getAttribute('data-theme') === 'light';
        if (isLight) { html.removeAttribute('data-theme'); localStorage.setItem('sg-theme','dark'); }
        else { html.setAttribute('data-theme','light'); localStorage.setItem('sg-theme','light'); }
        syncThemeIcons();
      }
      function syncThemeIcons() {
        const isLight = document.documentElement.getAttribute('data-theme') === 'light';
        document.querySelectorAll('.themeToggleBtn').forEach(b => b.textContent = isLight ? '‚òÄÔ∏è' : 'üåô');
      }
      document.querySelectorAll('.themeToggleBtn').forEach(btn => btn.addEventListener('click', toggleTheme));
      syncThemeIcons();

      // Bottom navigation
      els.bottomNav.addEventListener('click', e => {
        const item = e.target.closest('.bnItem[data-tab]');
        if (!item) return;
        switchTab(item.dataset.tab);
      });

      mq.addEventListener('change', updateFilters);
      updateFilters();

      (function(){
        const scrollThreshold = 80;
        const onScroll = () => {
          const scrolled = window.scrollY > scrollThreshold;
          document.body.classList.toggle('scrolled', scrolled);
        };
        window.addEventListener('scroll', onScroll, { passive: true });
        onScroll();
      })();

      els.quickActionsToggle.addEventListener('click', () => {
        const c = getClient();
        openDrawer({title:"–ë—ã—Å—Ç—Ä—ã–µ –¥–µ–π—Å—Ç–≤–∏—è",sub:c.name,status:"ok",updated:c.updatedAt,fields:[
          {k:"–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å",v:"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Ä–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Ä–∞–±–æ—Ç—ã"},
          {k:"–ó–∞–º–µ–Ω–∞ –∏–ª–∏ —Å–ø–∏—Å–∞–Ω–∏–µ —à–∏–Ω—ã",v:"–û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–º–µ–Ω—É/—Å–ø–∏—Å–∞–Ω–∏–µ –ø–æ –ø–æ–∑–∏—Ü–∏–∏"},
          {k:"–ü–æ–¥–∞—Ç—å —Ä–µ–∫–ª–∞–º–∞—Ü–∏—é",v:"–û—Ç–∫—Ä—ã—Ç—å –∑–∞—è–≤–∫—É –ø–æ —à–∏–Ω–µ –∏–ª–∏ –¢–°"},
          {k:"–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å",v:"–í—ã–±—Ä–∞—Ç—å —Å–ª–æ—Ç –∏ –°–¢–û"},
          {k:"–ó–∞–∫–∞–∑–∞—Ç—å —à–∏–Ω—ã",v:"–ü–æ–¥–±–æ—Ä –∏ –∑–∞–∫–∞–∑ –ø–æ –ø–∞—Ä–∫—É"},
          {k:"–ñ–∞–ª–æ–±—ã –∏ —Å—Ç–∞—Ç—É—Å—ã",v:"–û—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –∑–∞—è–≤–æ–∫ –∏ –æ–±—Ä–∞—â–µ–Ω–∏–π"}
        ]});
      });

      els.drawerClose.addEventListener('click', closeDrawer);
      els.drawerOverlay.addEventListener('click', e => { if (e.target === els.drawerOverlay) closeDrawer(); });
      els.drawerAction2.addEventListener('click', () => {
        if ((drawerCtx.type === "tire" || drawerCtx.type === "vehicle") && drawerCtx.photos.length)
          openPhoto(drawerCtx.title, drawerCtx.photos, 0);
      });

      els.photoClose.addEventListener('click', closePhoto);
      els.photoOverlay.addEventListener('click', e => { if (e.target === els.photoOverlay) closePhoto(); });
      els.photoPrev.addEventListener('click', () => movePhoto(-1));
      els.photoNext.addEventListener('click', () => movePhoto(1));

      document.addEventListener('keydown', e => {
        if (e.key === "Escape") { if (photoState.open) closePhoto(); else closeDrawer(); }
        if (photoState.open && e.key === "ArrowLeft") movePhoto(-1);
        if (photoState.open && e.key === "ArrowRight") movePhoto(1);
      });

      // Touch swipe
      let touchX = null;
      els.photoImg.addEventListener('touchstart', e => { touchX = e.touches[0].clientX; }, {passive:true});
      els.photoImg.addEventListener('touchend', e => {
        if (touchX === null) return;
        const dx = e.changedTouches[0].clientX - touchX;
        touchX = null;
        if (Math.abs(dx) > 45) movePhoto(dx < 0 ? 1 : -1);
      }, {passive:true});

      $('priorityList').addEventListener('click', handlePriorityClick);
      $('events').addEventListener('click', handleEventClick);
      $('vehicleWrap').addEventListener('click', handleVehicleClick);
      $('tiresTable').addEventListener('click', handleTireTableClick);

      render();
    }

    function debounce(fn, ms) { let t; return function(...a) { clearTimeout(t); t = setTimeout(() => fn.apply(this, a), ms); }; }

    function switchTab(tabName) {
      state.tab = tabName;
      if (tabName !== 'fleet') {
        state.status = 'all';
        els.statusSel.value = 'all';
      }
      document.querySelectorAll('.tab').forEach(t => {
        const isActive = t.dataset.tab === tabName;
        t.classList.toggle('active', isActive);
        t.setAttribute('aria-selected', isActive);
      });
      // Sync bottom nav
      document.querySelectorAll('.bnItem').forEach(b => b.classList.toggle('active', b.dataset.tab === tabName));
      render();
      // Scroll to top on tab switch (mobile)
      if (window.innerWidth < 980) window.scrollTo({top:0, behavior:'smooth'});
    }

    function updateFilterChipsUI() {
      document.querySelectorAll('#filterChips .chip[data-filter]').forEach(chip => {
        chip.classList.toggle('active', chip.dataset.filter === state.status);
      });
    }

    // Render
    function render() {
      const client = getClient();
      const titles = {fleet:"–û–±–∑–æ—Ä –ø–∞—Ä–∫–∞", vehicle:"–ö–∞—Ä—Ç–∞ –¢–°", tires:"–†–µ–µ—Å—Ç—Ä —à–∏–Ω"};
      const subs = {fleet:"–°–æ—Å—Ç–æ—è–Ω–∏–µ —à–∏–Ω –ø–æ –¢–°, –æ—Ç–∫–ª–æ–Ω–µ–Ω–∏—è –∏ —Ä–∏—Å–∫–∏", vehicle:"–°–æ—Å—Ç–æ—è–Ω–∏–µ —à–∏–Ω –ø–æ –∞–≤—Ç–æ–º–æ–±–∏–ª—è–º, –∏–Ω—Å–ø–µ–∫—Ü–∏–∏", tires:"–ò—Å—Ç–æ—Ä–∏—è, –∏–Ω—Å–ø–µ–∫—Ü–∏–∏, —Ñ–æ—Ç–æ. –ü–æ–¥—Å–≤–µ—Ç–∫–∞ ‚Äî —Å—Ç–æ–∏–º–æ—Å—Ç—å 1 –∫–º"};
      els.mainTitle.textContent = titles[state.tab];
      els.mainSub.textContent = `${subs[state.tab]} ¬∑ –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ: ${client.updatedAt}`;

      els.viewFleet.hidden = state.tab !== "fleet";
      els.viewVehicle.hidden = state.tab !== "vehicle";
      els.viewTires.hidden = state.tab !== "tires";

      renderFleet(client);
      renderVehicles(client);
      renderTires(client);
      renderEvents(client);
      updateFilterChipsUI();
    }

    function renderFleet(client) {
      const f = client.fleet;
      const kpiData = [
        {label:"–¢–°",value:f.vehicles,hint:"–í –∑–æ–Ω–µ –æ—Ç–≤–µ—Ç—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏",go:"vehicle"},
        {label:"–®–∏–Ω—ã",value:f.tires,hint:"–° –ø—Ä–∏–≤—è–∑–∫–æ–π –∫ –ø–æ–∑–∏—Ü–∏—è–º",go:"tires"},
        {label:"–ü—Ä–æ–≥–Ω–æ–∑ –∑–∞—Ç—Ä–∞—Ç",value:fmtUAH(f.forecastCost30),hint:"–î–µ—Ç–∞–ª–∏–∑–∞—Ü–∏—è –∏ —Å—Ä–∞–≤–Ω–µ–Ω–∏–µ –±—ã–ª–æ/—Å—Ç–∞–ª–æ",action:"costs"},
        {label:"–†–∏—Å–∫ –ø—Ä–æ—Å—Ç–æ—è",value:f.downtimeRisk30,hint:"SLA: "+f.sla}
      ];
      els.kpis.innerHTML = kpiData.map(k => `<div class="kpi${k.go||k.action?" clickable":""}"${k.go?` data-go="${k.go}"`:""}${k.action?` data-action="${k.action}"`:""}>
        <div class="label">${k.label}</div><div class="value">${k.value}</div><div class="hint">${esc(k.hint)}</div>
      </div>`).join("");

      els.chipOk.textContent = `–ù–æ—Ä–º–∞: ${f.ok}`;
      els.chipWarn.textContent = `–í–Ω–∏–º–∞–Ω–∏–µ: ${f.warn}`;
      els.chipCrit.textContent = `–ö—Ä–∏—Ç–∏—á–Ω–æ: ${f.crit}`;

      let actions = filterByStatusAndQuery(client.actions, 'severity', a => `${a.title} ${a.desc} ${a.tags.join(" ")}`);
      actions.sort((a,b) => bySev(a.severity) - bySev(b.severity));

      els.priorityList.innerHTML = actions.length
        ? actions.map(a => `
          <div class="item" data-action="${a.id}">
            <div class="dot ${sevClass(a.severity)}" style="margin-top:6px"></div>
            <div class="meta">
              <p class="title">${esc(a.title)}
                <span class="badge ${sevClass(a.severity)}">${sevLabel(a.severity)}</span>
                <span class="badge">–°—Ä–æ–∫: ${a.due}</span>
                <span class="badge">–û—Ü–µ–Ω–∫–∞: ${fmtUAH(a.cost)}</span>
              </p>
              <p class="desc">${esc(a.desc)}</p>
              <div style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px">
                ${a.tags.map(t => `<span class="badge">${esc(t)}</span>`).join("")}
              </div>
            </div>
          </div>`).join("")
        : emptyState("–ù–µ—Ç —ç–ª–µ–º–µ–Ω—Ç–æ–≤","–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã.");
    }

    function renderVehicles(client) {
      let vehicles = filterByStatusAndQuery(client.vehicles, 'status', v => `${v.title} ${v.plate} ${v.notes} ${v.driver?.name||""}`);

      els.vehicleWrap.innerHTML = vehicles.length
        ? vehicles.map(v => {
          const svc = v.service;
          const svcHtml = svc ? `
            <div class="svcBlock">
              <div class="svcHead">
                <svg viewBox="0 0 24 24"><path d="M20 8h-3V4H3c-1.1 0-2 .9-2 2v11h2c0 1.66 1.34 3 3 3s3-1.34 3-3h6c0 1.66 1.34 3 3 3s3-1.34 3-3h2v-5l-3-4zM6 18.5c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5zm13.5-9l1.96 2.5H17V9.5h2.5zm-1.5 9c-.83 0-1.5-.67-1.5-1.5s.67-1.5 1.5-1.5 1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>
                –°–¢–û: ${esc(svc.station)} ‚Ä¢ ${svc.lastVisit}
              </div>
              <div class="svcRow">
                ${svc.done.slice(0,3).map(d => `<span class="svcItem done">‚úì ${esc(d)}</span>`).join("")}
              </div>
              ${svc.recommended.length ? `<div class="svcRow">${svc.recommended.slice(0,3).map(r => `<span class="svcItem rec">‚ö† ${esc(r)}</span>`).join("")}</div>` : ""}
              <button class="svcBtn" data-report="${svc.reportId}">üìÑ –û—Ç—á—ë—Ç –ø–æ –∏–Ω—Å–ø–µ–∫—Ü–∏–∏</button>
            </div>` : "";

          return `
          <div class="vehicleCard" data-vehicle="${v.id}">
            <div class="vehTop">
              <div style="min-width:0">
                <h3>${esc(v.title)} ‚Ä¢ ${esc(v.plate)}</h3>
                <div class="small">–ò–Ω—Å–ø–µ–∫—Ü–∏—è: ${v.lastInspection}</div>
                <div class="small">${esc(v.notes)}</div>
              </div>
              <span class="chip"><span class="dot ${sevClass(v.status)}"></span><span>${sevLabel(v.status)}</span></span>
            </div>
            <div class="ratingRow">
              <span class="chip"><span class="dot"></span><span>–í–æ–¥–∏—Ç–µ–ª—å: ${esc(v.driver?.name || "‚Äî")}</span></span>
              <div class="stars">${starsHtml(v.driver?.rating||0)}</div>
              <div class="ratingHint">${(v.driver?.rating??0).toFixed(1)} ‚Ä¢ 30–¥: ${(v.driver?.last30??0).toFixed(1)}</div>
            </div>
            ${v.photos?.length ? `<div class="vehPhotos">${v.photos.slice(0,3).map((url,i)=>`<div class="vehPhoto" data-veh="${v.id}" data-idx="${i}"><img src="${url}" alt="–¢–°" loading="lazy"></div>`).join("")}</div>` : ""}
            ${svcHtml}
            <div class="axles">
              ${v.axles.map(ax => `
                <div class="axle">
                  <div class="label">${ax.name}</div>
                  <div class="tires">${ax.tires.map(t => `<div class="tire ${sevClass(t.risk)}" data-tire="${t.id}" title="${esc(t.code)}">${esc(t.pos)}</div>`).join("")}</div>
                </div>`).join("")}
            </div>
          </div>`}).join("")
        : `<div class="vehicleCard"><div class="vehTop"><div><h3>–ù–µ—Ç –¢–°</h3><div class="small">–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã.</div></div></div></div>`;
    }

    function renderTires(client) {
      const allTires = getTires();
      let filtered = filterByStatusAndQuery(allTires, 'risk', t => `${t.code} ${t.brand||""} ${t.serialNo||""} ${t.vTitle} ${t.plate} ${t.pos} ${t.axle} ${t.wear} ${t.replaceETA}`);
      filtered.sort((a,b) => a.cpk - b.cpk);

      els.tiresCount.textContent = `–û—Ç–æ–±—Ä–∞–∂–µ–Ω–æ: ${filtered.length} / ${allTires.length}`;

      els.tiresTable.innerHTML = filtered.map(t => {
        const isBest = bestSet.has(t.id);
        const thumbs = t.photos?.length
          ? t.photos.slice(0,3).map((url,i) => `<div class="thumb" data-tire="${t.id}" data-idx="${i}"><img src="${url}" alt="${esc(t.code)}" loading="lazy"></div>`).join("")
          : `<div class="thumbLabel">–ù–µ—Ç —Ñ–æ—Ç–æ</div>`;

        const warrantyHtml = t.product && t.warranty
          ? `<span class="warrantyBadge"><svg viewBox="0 0 24 24"><path d="M12 1L3 5v6c0 5.55 3.84 10.74 9 12 5.16-1.26 9-6.45 9-12V5l-9-4zm0 10.99h7c-.53 4.12-3.28 7.79-7 8.94V12H5V6.3l7-3.11v8.8z"/></svg>${esc(t.warranty.type)}</span>`
          : "";
        const repairsHtml = t.repairs?.length
          ? `<span class="repairBadge">üîß ${t.repairs.length} —Ä–µ–º–æ–Ω—Ç${t.repairs.length>1?"–∞":""}</span>`
          : "";

        return `
          <tr data-tire="${t.id}">
            <td>
              <div style="display:flex;gap:6px;flex-wrap:wrap;align-items:center">
                <span class="chip"><span class="dot ${sevClass(t.risk)}"></span><span>${esc(t.code)}</span></span>
                ${isBest ? `<span class="badge best">–¢–û–ü</span>` : ""}
                <span class="badge">${esc(t.brand||"‚Äî")}</span>
                ${warrantyHtml}
                ${repairsHtml}
              </div>
            </td>
            <td class="rowLine">${esc(t.vTitle)} ‚Ä¢ ${esc(t.plate)}</td>
            <td class="rowCols">
              <span class="badge">${esc(t.axle)} ‚Ä¢ ${esc(t.pos)}</span>
              <span class="badge">–û—Å—Ç–∞—Ç–æ–∫: ${t.tread.toFixed(1)} –º–º</span>
              <span class="badge ${sevClass(t.risk)}">${sevLabel(t.risk)}</span>
            </td>
            <td class="rowCols">
              <span class="badge">–ü—Ä–æ–±–µ–≥: ${t.kmRun ? fmtK(t.kmRun) : "‚Äî"}</span>
              <span class="badge">–¶–µ–Ω–∞: ${t.cost ? fmtUAH(t.cost) : "‚Äî"}</span>
              <span class="badge ${isBest?"best":""}">1–∫–º: ${fmtCpk(t.cpk)}</span>
            </td>
            <td><div class="thumbRow"><div class="thumbs">${thumbs}</div></div></td>
          </tr>`;
      }).join("");
    }

    function renderEvents(client) {
      let evs = filterByStatusAndQuery(client.events, 'severity', e => `${e.title} ${e.desc} ${e.when}`);
      evs.sort((a,b) => bySev(a.severity) - bySev(b.severity));

      els.eventsCount.textContent = `–°–æ–±—ã—Ç–∏–π: ${evs.length}`;
      els.events.innerHTML = evs.length
        ? evs.map(e => `
          <div class="item" data-event="${e.id}">
            <div class="dot ${sevClass(e.severity)}" style="margin-top:6px"></div>
            <div class="meta">
              <p class="title">${esc(e.title)}
                <span class="badge ${sevClass(e.severity)}">${sevLabel(e.severity)}</span>
                <span class="badge">–î–∞—Ç–∞: ${e.when}</span>
              </p>
              <p class="desc">${esc(e.desc)}</p>
            </div>
          </div>`).join("")
        : emptyState("–ù–µ—Ç —Å–æ–±—ã—Ç–∏–π","–ò–∑–º–µ–Ω–∏—Ç–µ —Ñ–∏–ª—å—Ç—Ä—ã.");
    }

    function filterByStatusAndQuery(arr, statusKey, textFn) {
      let result = arr;
      if (state.status !== "all") result = result.filter(x => x[statusKey] === state.status);
      if (state.q) result = result.filter(x => textFn(x).toLowerCase().includes(state.q));
      return result;
    }
    function emptyState(title, desc) {
      return `<div class="item" style="cursor:default"><div class="meta"><p class="title">${esc(title)}</p><p class="desc">${esc(desc)}</p></div></div>`;
    }

    // Event handlers
    function handlePriorityClick(e) {
      const item = e.target.closest('.item[data-action]');
      if (!item) return;
      const client = getClient();
      const a = client.actions.find(x => x.id === item.dataset.action);
      if (!a) return;
      openDrawer({title:a.title,sub:`–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è ‚Ä¢ ${client.name}`,status:a.severity,updated:client.updatedAt,fields:[
        {k:"–°—Ä–æ—á–Ω–æ—Å—Ç—å",v:sevLabel(a.severity)},{k:"–°—Ä–æ–∫",v:a.due},{k:"–û—Ü–µ–Ω–∫–∞",v:fmtUAH(a.cost)},
        {k:"–û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ",v:a.desc},{k:"–¢–µ–≥–∏",v:a.tags.join(", ")},{k:"–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥",v:"–ó–∞–∫–∞–∑-–Ω–∞—Ä—è–¥ ‚Üí —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–∏–µ"}
      ]});
      setDrawerCtx(null,[],null);
    }

    function handleEventClick(e) {
      const item = e.target.closest('.item[data-event]');
      if (!item) return;
      const client = getClient();
      const ev = client.events.find(x => x.id === item.dataset.event);
      if (!ev) return;
      openDrawer({title:ev.title,sub:`–°–æ–±—ã—Ç–∏–µ ‚Ä¢ ${client.name}`,status:ev.severity,updated:client.updatedAt,fields:[
        {k:"–î–∞—Ç–∞",v:ev.when},{k:"–ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç",v:sevLabel(ev.severity)},{k:"–û–ø–∏—Å–∞–Ω–∏–µ",v:ev.desc},
        {k:"SLA",v:client.fleet.sla},{k:"–°–ª–µ–¥—É—é—â–∏–π —à–∞–≥",v:"–ü–æ–¥—Ç–≤–µ—Ä–¥–∏—Ç—å —Å–ª–æ—Ç"}
      ]});
      setDrawerCtx(null,[],null);
    }

    function handleVehicleClick(e) {
      const client = getClient();
      // Click tire
      const tireEl = e.target.closest('.tire[data-tire]');
      if (tireEl) {
        e.stopPropagation();
        const t = getTires().find(x => x.id === tireEl.dataset.tire);
        showTireDrawer(t, client);
        return;
      }
      // Click photo
      const photoEl = e.target.closest('.vehPhoto[data-veh]');
      if (photoEl) {
        e.stopPropagation();
        const v = client.vehicles.find(x => x.id === photoEl.dataset.veh);
        if (v?.photos?.length) openPhoto(`${v.title} ‚Ä¢ ${v.plate}`, v.photos, +photoEl.dataset.idx || 0);
        return;
      }
      // Click report button
      const reportBtn = e.target.closest('.svcBtn[data-report]');
      if (reportBtn) {
        e.stopPropagation();
        alert(`–û—Ç–∫—Ä—ã—Ç–∏–µ –æ—Ç—á—ë—Ç–∞: ${reportBtn.dataset.report}`);
        return;
      }
      // Click card
      const vCard = e.target.closest('.vehicleCard[data-vehicle]');
      if (!vCard) return;
      const v = client.vehicles.find(x => x.id === vCard.dataset.vehicle);
      if (!v) return;
      const fields = [
        {k:"–ò–Ω—Å–ø–µ–∫—Ü–∏—è",v:v.lastInspection},{k:"–°—Ç–∞—Ç—É—Å",v:sevLabel(v.status)},{k:"–ó–∞–º–µ—á–∞–Ω–∏—è",v:v.notes},
        {k:"–í–æ–¥–∏—Ç–µ–ª—å",v:v.driver?.name||"‚Äî"},{k:"–†–µ–π—Ç–∏–Ω–≥",v:`${(v.driver?.rating??0).toFixed(1)} (30–¥: ${(v.driver?.last30??0).toFixed(1)})`},
        {k:"–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π",v:v.driver?.notes||"‚Äî"}
      ];
      // Service info
      if (v.service) {
        fields.push({k:"üöó –ü–æ—Å–ª–µ–¥–Ω–∏–π –°–¢–û",v:`${v.service.station} (${v.service.lastVisit})`});
        if (v.service.done?.length) fields.push({k:"‚úì –í—ã–ø–æ–ª–Ω–µ–Ω–æ",v:v.service.done.join("; ")});
        if (v.service.recommended?.length) fields.push({k:"‚ö† –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω–æ",v:v.service.recommended.join("; ")});
        fields.push({k:"–û—Ç—á—ë—Ç",v:`#${v.service.reportId}`});
      }
      fields.push({k:"–§–æ—Ç–æ –¢–°",v:v.photos?.length?`${v.photos.length} —à—Ç (–∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ¬ª)`:"–ù–µ—Ç"});
      openDrawer({title:`–¢–°: ${v.title}`,sub:v.plate,status:v.status,updated:client.updatedAt,fields});
      setDrawerCtx("vehicle", v.photos||[], `–¢–°: ${v.title}`);
    }

    function handleTireTableClick(e) {
      const client = getClient();
      // Click thumb
      const thumbEl = e.target.closest('.thumb[data-tire]');
      if (thumbEl) {
        e.stopPropagation();
        const t = getTires().find(x => x.id === thumbEl.dataset.tire);
        if (t?.photos?.length) openPhoto(`–®–∏–Ω–∞ ${t.code}`, t.photos, +thumbEl.dataset.idx || 0);
        return;
      }
      // Click row
      const row = e.target.closest('tr[data-tire]');
      if (!row) return;
      const t = getTires().find(x => x.id === row.dataset.tire);
      showTireDrawer(t, client);
    }

    function showTireDrawer(t, client) {
      if (!t) return;
      const isBest = bestSet.has(t.id);
      const fields = [
        {k:"–ú–∞—Ä–∫–∞",v:t.brand||"‚Äî"},{k:"–°–µ—Ä–∏–π–Ω—ã–π –Ω–æ–º–µ—Ä",v:t.serialNo||"‚Äî"},
        {k:"–ü—Ä–æ–±–µ–≥",v:t.kmRun?fmtKM(t.kmRun):"‚Äî"},{k:"–°—Ç–æ–∏–º–æ—Å—Ç—å —à–∏–Ω—ã",v:t.cost?fmtUAH(t.cost):"‚Äî"},
        {k:"–°—Ç–æ–∏–º–æ—Å—Ç—å 1 –∫–º",v:fmtCpk(t.cpk)+(isBest?" ‚Ä¢ –¢–û–ü":"")},
        {k:"–û—Å—Ç–∞—Ç–æ–∫ –ø—Ä–æ—Ç–µ–∫—Ç–æ—Ä–∞",v:`${t.tread.toFixed(1)} –º–º`},{k:"–•–∞—Ä–∞–∫—Ç–µ—Ä –∏–∑–Ω–æ—Å–∞",v:t.wear},{k:"–î–∞–≤–ª–µ–Ω–∏–µ",v:t.pressure},
        {k:"–ü—Ä–æ–≥–Ω–æ–∑ –∑–∞–º–µ–Ω—ã",v:t.replaceETA},{k:"–û—Å—Ç. —Ä–µ—Å—É—Ä—Å",v:t.kmLeft?fmtKM(t.kmLeft):"‚Äî"}
      ];
      // Warranty info
      if (t.product && t.warranty) {
        fields.push({k:"üõ°Ô∏è –ì–∞—Ä–∞–Ω—Ç–∏—è",v:`${t.warranty.type} (–¥–æ ${t.warranty.until})`});
        if (t.warranty.services?.length) fields.push({k:"–°–µ—Ä–≤–∏—Å–Ω—ã–µ –æ–ø—Ü–∏–∏",v:t.warranty.services.join("; ")});
      } else {
        fields.push({k:"–ì–∞—Ä–∞–Ω—Ç–∏—è",v:"–ù–µ –≤ –ø—Ä–æ–¥—É–∫—Ç–µ"});
      }
      // Repairs
      if (t.repairs?.length) {
        const repList = t.repairs.map(r => `${r.date}: ${r.type} (${fmtUAH(r.cost)}) ‚Äî ${r.station}`).join("\n");
        fields.push({k:"üîß –ò—Å—Ç–æ—Ä–∏—è —Ä–µ–º–æ–Ω—Ç–æ–≤",v:repList});
      }
      fields.push(
        {k:"–§–æ—Ç–æ —à–∏–Ω—ã",v:t.photos?.length?`${t.photos.length} —à—Ç (–∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å —Ñ–æ—Ç–æ¬ª)`:"–ù–µ—Ç"},
        {k:"–í–æ–¥–∏—Ç–µ–ª—å",v:t.driver?`${t.driver.name} ‚Ä¢ ${(t.driver.rating??0).toFixed(1)}`:"‚Äî"},
        {k:"–†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏—è",v:t.risk==="crit"?"–ó–∞–º–µ–Ω–∞ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç–Ω–æ":t.risk==="warn"?"–ö–æ–Ω—Ç—Ä–æ–ª—å + –ø–ª–∞–Ω":"–ü–æ –≥—Ä–∞—Ñ–∏–∫—É"}
      );
      openDrawer({title:`–®–∏–Ω–∞ ${t.code}`,sub:`${t.vTitle} ‚Ä¢ ${t.plate} ‚Ä¢ ${t.axle} ‚Ä¢ ${t.pos}`,status:t.risk,updated:client.updatedAt,fields});
      setDrawerCtx("tire", t.photos||[], `–®–∏–Ω–∞ ${t.code}`);
    }

    function showCostsDrawer() {
      const client = getClient();
      const c = client.fleet.costs;
      const total = c.maintenance + c.repair + c.tires;
      const fields = [
        {k:"üîß –û–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–µ (–¢–û)",v:`${fmtUAH(c.maintenance)}\n${c.maintenanceItems.join("\n")}`},
        {k:"üõ†Ô∏è –†–µ–º–æ–Ω—Ç",v:`${fmtUAH(c.repair)}\n${c.repairItems.join("\n")}`},
        {k:`üõû –ó–∞–∫—É–ø–∫–∞ —à–∏–Ω (${c.tiresCount} —à—Ç)`,v:`${fmtUAH(c.tires)}\n${c.tiresItems.join("\n")}`},
        {k:"üìä –ò–¢–û–ì–û",v:fmtUAH(total)}
      ];
      openDrawer({
        title:"–ü—Ä–æ–≥–Ω–æ–∑ –∑–∞—Ç—Ä–∞—Ç (30 –¥–Ω–µ–π)",
        sub:client.name,
        status:"ok",
        updated:client.updatedAt,
        fields
      });
      setDrawerCtx(null,[],null);
    }

    // Drawer
    function openDrawer({title, sub, status, updated, fields}) {
      els.drawerTitle.textContent = title;
      els.drawerSub.textContent = sub;
      els.drawerStatusChip.innerHTML = `<span class="dot ${sevClass(status)}"></span><span>${sevLabel(status)}</span>`;
      els.drawerUpdated.textContent = `–û–±–Ω–æ–≤–ª–µ–Ω–æ: ${updated}`;
      els.drawerFields.innerHTML = fields.map(f => `<div class="field"><div class="k">${esc(f.k)}</div><div class="v">${esc(f.v).replace(/\n/g,"<br>")}</div></div>`).join("");
      els.drawerOverlay.style.display = "flex";
      setDrawerButtons(null);
    }
    function closeDrawer() { els.drawerOverlay.style.display = "none"; }
    function setDrawerCtx(type, photos, title) {
      drawerCtx = {type, photos: photos||[], title: title||""};
      setDrawerButtons(type);
    }
    function setDrawerButtons(type) {
      els.drawerAction1.textContent = "–°–æ–≥–ª–∞—Å–æ–≤–∞—Ç—å —Å–µ—Ä–≤–∏—Å";
      els.drawerAction2.textContent = (type === "tire" || type === "vehicle") ? "–§–æ—Ç–æ / –ò–Ω—Å–ø–µ–∫—Ü–∏–∏" : "–ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–π";
      els.drawerAction3.textContent = "–ó–∞–ø–∏—Å–∞—Ç—å—Å—è –Ω–∞ —Å–µ—Ä–≤–∏—Å";
    }

    // Photo viewer
    function openPhoto(title, photos, idx) {
      if (!photos?.length) return;
      photoState = {open:true, title, photos:photos.slice(), idx:Math.max(0,Math.min(photos.length-1,idx||0))};
      els.photoOverlay.style.display = "block";
      renderPhoto();
    }
    function closePhoto() { photoState.open = false; els.photoOverlay.style.display = "none"; }
    function movePhoto(d) {
      if (!photoState.open || !photoState.photos.length) return;
      const n = photoState.photos.length;
      photoState.idx = (photoState.idx + d + n) % n;
      renderPhoto();
    }
    function renderPhoto() {
      const {title, photos, idx} = photoState;
      els.photoTitle.textContent = `${title} ‚Ä¢ ${idx+1}/${photos.length}`;
      els.photoImg.src = photos[idx];
      els.photoDots.innerHTML = photos.map((_,i) => `<div class="pDot${i===idx?" on":""}" data-i="${i}"></div>`).join("");
      els.photoDots.querySelectorAll('.pDot').forEach(d => d.addEventListener('click', () => { photoState.idx = +d.dataset.i; renderPhoto(); }));
    }

    if (document.readyState === "loading") document.addEventListener("DOMContentLoaded", init);
    else init();
  })();
  </script>
</body>
</html>
